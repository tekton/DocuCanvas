{% extends "base.html" %}

{% block context_nav %}
    <a href="/notification/all">All Notifications</a>
    <a href="/notification/new">New Notification</a>
{% endblock%}

{% block container %}
<div id="formContainer">
    <form action="/notification/new" id = "checkListForm" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input maxlength="255" name="creator" type="hidden" value="{{user.id}}"  />
        Message: <input maxlength="255" name="message" type="text" /><br />
        Send To: <br/>
        <div id="notificationContainer" style = 'border: solid 1px'>
            <div>
                <input id="id_notificationrecipient_set-TOTAL_FORMS" name="notificationrecipient_set-TOTAL_FORMS" type="hidden" value="1" /><input id="id_notificationrecipient_set-INITIAL_FORMS" name="notificationrecipient_set-INITIAL_FORMS" type="hidden" value="0" /><input id="id_notificationrecipient_set-MAX_NUM_FORMS" name="notificationrecipient_set-MAX_NUM_FORMS" type="hidden" value="{{num_users}}" />


                <tr><th><label for="id_notificationrecipient_set-0-user">User:</label></th><td><select id="id_notificationrecipient_set-0-user" name="notificationrecipient_set-0-user">
                <option value="" selected="selected">---------</option>
                <option value="1">jason</option>
                <option value="2">batman</option>
                <option value="3">superman</option>
                <option value="4">greenlantern</option>
                <option value="5">flash</option>
                </select></td></tr>
                <tr><th>
                <input id="id_notificationrecipient_set-0-read" name="notificationrecipient_set-0-read" value="3" type="hidden" />
                <!--<label for="id_notificationrecipient_set-0-read">Read:</label></th><td><select id="id_notificationrecipient_set-0-read" name="notificationrecipient_set-0-read">
                <option value="1">Unknown</option>
                <option value="2">Yes</option>
                <option value="3" selected="selected">No</option>
                </select>--><input id="id_notificationrecipient_set-0-notification" name="notificationrecipient_set-0-notification" type="hidden" /><input id="id_notificationrecipient_set-0-id" name="notificationrecipient_set-0-id" type="hidden" /></td></tr>
            </div>
        </div>
        <input title='Add a new notification recipient' type='button' name='add_notification_recipient' value='Add Item' onclick ='addNotificationRecipient()'/>
        <input type="submit" name="submit" value="Submit"/>
    </form>
</div>
<script>
var notificationNumber = 1, notification_recipients = JSON.parse('{{users|safe}}');
function addNotificationRecipient(){
    var new_notification_recipient = "<div><tr><th><label for='id_notificationrecipient_set-" + notificationNumber+ "-user'>User:</label></th><td><select id='id_notificationrecipient_set-" + notificationNumber + "-user' name='notificationrecipient_set-" + notificationNumber + "-user'><option value='' selected='selected'>---------</option>";

    if(parseInt($('#id_notificationrecipient_set-TOTAL_FORMS').val()) < parseInt('{{num_users}}')){
        for(key in notification_recipients){
            if( notification_recipients.hasOwnProperty(key)){
                new_notification_recipient += "<option value=" + key + ">" + notification_recipients[key] + "</option>"
            }
        }

        new_notification_recipient += "<input id='id_notificationrecipient_set-" + notificationNumber + "-read' name='notificationrecipient_set-" + notificationNumber + "-read' value='3' type='hidden' /><input id='id_notificationrecipient_set-" + notificationNumber + "-notification' name='notificationrecipient_set-" + notificationNumber + "-notification' type='hidden'/><input id='id_notificationrecipient_set-" + notificationNumber + "-id' name='notificationrecipient_set-" + notificationNumber + "-id'type='hidden' /></td></tr>";

        $('#notificationContainer').append(new_notification_recipient);
        notificationNumber ++;
        $('#id_notificationrecipient_set-TOTAL_FORMS').val(function(i, oldval){
            return ++oldval;
        });
        console.log($('#id_notificationrecipient_set-TOTAL_FORMS').val());
        //$('#checkListTable').append('<input type="submit" name="submit" value="Submit">');
    }
}
$(function() {
    $("#notificationContainer").sortable({
      stop: function(e, ui){
         $('#notificationContainer input[type="hidden"][id="sort"]').each(function(i){
          this.value = i
        })
      }
    });
    $("#notificationContainer").disableSelection();
  });
</script>
{% endblock %}