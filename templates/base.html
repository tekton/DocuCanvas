<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Gadget</title>
        <link rel="stylesheet" href="/static/css/jquery-ui.css" />
        <style>
            ::-moz-selection {
                background: #b3d4fc;
                text-shadow: none;
            }

            ::selection {
                background: #b3d4fc;
                text-shadow: none;
            }

            html {
                padding: 0 10px;
                font-size: 20px;
                line-height: 1.4;
                color: #737373;
                background: #f0f0f0;
                -webkit-text-size-adjust: 100%;
                -ms-text-size-adjust: 100%;
            }

            html,
            input {
                font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            }

            body {
                max-width: 900px;
                _width: 900px;
                padding: 30px 20px 50px;
                border-width: 0 1px;
                border-style: solid;
                border-color: #b3b3b3;
                margin: 0 auto;
                box-shadow: 0 1px 10px #a7a7a7, inset 0 1px 0 #fff;
                background: #fcfcfc;
            }

            h1 {
                margin: 0 10px;
                font-size: 50px;
                text-align: center;
            }

            h1 span {
                color: #bbb;
            }

            h3 {
                margin: 1.5em 0 0.5em;
            }

            p {
                margin: 1em 0;
            }

            ul {
                padding: 0 0 0 40px;
                margin: 1em 0;
            }

            a{
                text-decoration:none;
                color:#737373;
            }

            .ui-icon{
                display:inline-block;
            }

            .ui-icon:hover{
                cursor:pointer;
            }

            #home_icon{
                border-style:solid;
                border-radius:3px;
                border-color:#bbb;
            }

            .container {
                /*max-width: 1000px;*/
                _width: 380px;
                margin: 0 auto;
                margin-right: 225px;
                padding: 30px 20px 50px;
                border: 1px solid white;
                border-radius: 4px;
                box-shadow: 0 1px 10px #a7a7a7, inset 0 1px 0 #fff;
                background: #fcfcfc;
            }

            .container_nav{
                /*max-width: 1000px;*/
                _width: 380px;
                margin: 0 auto;
                margin-right: 225px;
                padding: 30px 20px 50px;
                border: 1px solid white;
                border-radius: 4px;
                box-shadow: 0 1px 10px #a7a7a7, inset 0 1px 0 #fff;
                background: #fcfcfc;
            }

            .container_nav a{
                display:inline-block;
                width:100%;
                border-radius: 4px;
            }

            .container_nav a:hover{
                cursor:pointer;
                background:#bbb;
            }

            .spiffy_box {
                max-width: 150px;
                _width: 150px;
                margin: 0 auto;

                padding: 30px 20px 50px;
                border: 1px solid white;
                border-radius: 4px;
                box-shadow: 0 1px 10px #a7a7a7, inset 0 1px 0 #fff;
                background: #fcfcfc;             
            }

            .left {
                float: left;
            }
            
            .right {
                float: right;
            }
            
            .right-avoid {
                
            }
            
            .both {
                clear: both;
            }

            .main_nav_button{
                display:inline;
            }

            .main_nav_button:hover{
                cursor:pointer;
            }

            /* navigation bar */
            #advanced_search{
            }

            #context_nav {
                width: 20em;
                padding: 1em;
                position: absolute;
                top: 6.5em;
                right: 40em;
                min-height: 2em;
                height:auto;
                overflow: hidden;
                z-index:10;
                font-size:0.7em;
                display:none;
            }

            #projects_nav {
                width: 20em;
                padding: 1em;
                position: absolute;
                top: 6.5em;
                right: 26.5em;
                min-height: 2em;
                height:auto;
                overflow: hidden;
                z-index:10;
                font-size:0.7em;
                display:none;
            }


            #account_nav {
                width: 135px;
                padding: 1em;
                position: absolute;
                top: 6.5em;
                right: 28.5em;
                height: 2em;
                overflow: hidden;
                z-index:10;
                font-size:0.7em;
                display:none;
            }
            #search_nav {
                width: 10em;
                padding: 1em;
                position: absolute;
                top: 6.5em;
                right:22em;
                height: 2em;
                overflow: hidden;
                z-index:10;
                font-size:0.7em;
                display:none;
            }

            /* google search */

            #goog-fixurl ul {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            #goog-fixurl form {
                margin: 0;
            }

            #goog-wm-qt,
            #goog-wm-sb {
                border: 1px solid #bbb;
                font-size: 16px;
                line-height: normal;
                vertical-align: top;
                color: #444;
                border-radius: 2px;
            }

            #goog-wm-qt {
                width: 220px;
                height: 20px;
                padding: 5px;
                margin: 5px 10px 0 0;
                box-shadow: inset 0 1px 1px #ccc;
            }

            #goog-wm-sb {
                display: inline-block;
                height: 32px;
                padding: 0 10px;
                margin: 5px 0 0;
                white-space: nowrap;
                cursor: pointer;
                background-color: #f5f5f5;
                background-image: -webkit-linear-gradient(rgba(255,255,255,0), #f1f1f1);
                background-image: -moz-linear-gradient(rgba(255,255,255,0), #f1f1f1);
                background-image: -ms-linear-gradient(rgba(255,255,255,0), #f1f1f1);
                background-image: -o-linear-gradient(rgba(255,255,255,0), #f1f1f1);
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                *overflow: visible;
                *display: inline;
                *zoom: 1;
            }

            #goog-wm-sb:hover,
            #goog-wm-sb:focus {
                border-color: #aaa;
                box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
                background-color: #f8f8f8;
            }

            #goog-wm-qt:hover,
            #goog-wm-qt:focus {
                border-color: #105cb6;
                outline: 0;
                color: #222;
            }

            input::-moz-focus-inner {
                padding: 0;
                border: 0;
            }
        /* titles and stuff */
        .title {
            
        }
        
        .sub-title {
            
        }

#mainheader {
    padding-top: .6em;
    font-size: 30px;
}
.tbl-generic {
    border-collapse: collapse;
    border-spacing: 0;
    width: 100%;
    vertical-align: top;
}
.tbl-generic .tbl-rowheader {
    background: #bbb;
    font-size: .7em;
    height: 1.4em;
}
.tbl-generic th,
.tbl-generic .tbl-fauxth {
    font-weight: bold;
    text-align: left;
}

.tbl-issues {}
.tbl-issues th {
    text-align: left;
}
.tbl-issues .tbl-issues-summary {
    width: 85%;
}
.tbl-issues .tbl-issues-status {
    width: 15%;
}

.tbl-overview {}
.tbl-overview td {
    padding: .2em .4em;
}
.tbl-overview .tbl-overview-content {
    padding: .2em;
}

.tbl-comments {
    margin: 2em auto;
}
.tbl-comments .comment_textarea textarea {
    width: 100%;
}
.tbl-comments .tbl-comments-user {
    font-weight: bold;
    text-align: left;
    padding: .2em .4em;
}
.tbl-comments .tbl-comments-created {
    text-align: right;
    padding: .2em .4em;
    font-weight: normal;
}
.tbl-comments .tbl-comments-description {
    font-size: 1em;
    width: 100%;
    padding: .2em;
}
        {% block style %}{% endblock %}
        </style>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script><!-- shoudl be changed to local source?-->
        <script src="/static/scripts/jquery-ui.min.js"></script>
        <script>window.jQuery || document.write('<script src="/static/js/vendor/jquery-1.8.0.min.js"><\/script>')</script>

        <script type="text/javascript">
            var csrftoken;

            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

            function csrfSafeMethod(method) {
                // these HTTP methods do not require CSRF protection
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }

            function sameOrigin(url) {
                // test that a given url is a same-origin URL
                // url could be relative or scheme relative or absolute
                var host = document.location.host; // host + port
                var protocol = document.location.protocol;
                var sr_origin = '//' + host;
                var origin = protocol + sr_origin;
                // Allow absolute or scheme relative URLs to same origin
                return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
                    (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
                    // or any other URL that isn't scheme relative or absolute i.e relative.
                    !(/^(\/\/|http:|https:).*/.test(url));
            }

            /* Nav Menu - START */
            var NavMenu = {
                items: [],
                triggers: [],
                mapping: {
                    'account' : 'account_nav',
                    'projects_list' : 'projects_nav',
                    'context' : 'context_nav',
                    'search_icon' : 'search_nav'
                },
                _timeout: null,

                ClearDisplayTimeout: function(){
                    // Clears display timeout
                    if (NavMenu._timeout) {
                        clearTimeout(NavMenu._timeout);
                    }
                },

                SetDisplayTimeout: function(){
                    // Hide any open menu after 5 seconds if: 
                    //  Desktop User - mouses out from menu
                    //  Mobile User - does not click a menu item
                    NavMenu.ClearDisplayTimeout();
                    NavMenu._timeout = setTimeout(function(){
                        NavMenu.items.slideUp();
                    },5000);
                },

                HideAll: function(){
                    // Removes any pending timeout since we won't need it
                    NavMenu.ClearDisplayTimeout();
                    // Hide all visible menu items
                    NavMenu.items.slideUp();
                },

                ShowMenu: function(navId,trigger) {
                    // Remove 5 second timeout (refer to .SetDisplayTimeout)
                    NavMenu.ClearDisplayTimeout();

                    // Itterate through all menu items and hide or show them
                    NavMenu.items.each(function(i,el){
                        el = $(el);

                        // Toggle (slide) requested menu
                        if (el.attr('id') == navId) {
                            // Resets position of NavMenu to be aligned to the bottom left of the triggr
                            // Top, Left, and Right attributes removed from CSS
                            var offsetHeight = trigger.outerHeight(true),
                                offsetPosition = trigger.offset();

                            el.css({
                                top: offsetPosition.top + offsetHeight,
                                left: offsetPosition.left
                            });

                            el.slideToggle();
                        }
                        // Hide any other menu
                        else {
                            el.slideUp();
                        }
                    });

                    // Re-add timeout
                    NavMenu.SetDisplayTimeout();
                },

                Init: function(){
                    // Get mapped IDs for triggers and menus and put them into a DOM query array
                    $.each(NavMenu.mapping, function(k,v){
                        NavMenu.triggers.push('#'+k);
                        NavMenu.items.push('#'+v);
                    });
                    NavMenu.items = $(NavMenu.items.join(','));
                    NavMenu.triggers = $(NavMenu.triggers.join(','));

                    // Bind click event to triggers to show their corresponding menu, based on mapping
                    NavMenu.triggers.on("click", function(evt){
                        var trigger = $(this),
                            navId = NavMenu.mapping[trigger.attr('id')];
                        NavMenu.ShowMenu(navId,trigger);
                    });


                    NavMenu.items.on({
                        // Removes display timeout if the user is currently within the menu (desktop users)
                        mouseover: NavMenu.ClearDisplayTimeout,

                        // Re-add timeout after they mouse over menu
                        mouseout: NavMenu.SetDisplayTimeout
                    });

                    // If user clicks anything other than a menu item or trigger, hide the menus
                    $(document).click(function(evt){
                        var el = evt.target;

                        if ( $.inArray(el, NavMenu.triggers) > -1 || $.inArray(el, NavMenu.items) > -1 ) {
                            // Nav menu item was clicked
                            return;
                        }
                       
                        if ( $(el).parents('.navitem').length == 0 ) {
                            NavMenu.HideAll();
                        }
                    });

                    $('#search').on('click', NavMenu.HideAll);
                }
            };
            /* Nav Menu - END */

            $(document).ready(function(){
                csrftoken = getCookie('csrftoken');
                $.ajaxSetup({
                        beforeSend: function(xhr, settings) {
                            if (!csrfSafeMethod(settings.type) && sameOrigin(settings.url)) {
                                xhr.setRequestHeader("X-CSRFToken", csrftoken);
                            }
                        }
                });
                
                NavMenu.Init();

                /* OLD nav Menu 
                    $('#account').click(function(){
                        $('#account_nav').slideToggle();
                    });

                    $('#projects_list').click(function(){
                        $('#projects_nav').slideToggle();
                    });

                    $('#context').click(function(){
                        $('#context_nav').slideToggle();
                    });

                    $('#search_icon').click(function(){
                        $('#search_nav').slideToggle();
                    });
                    //$('#account_nav').hover(function(){},function(){$('#account_nav').slideToggle();}) 

                    $(document).click(function(event) { 
                        if($(event.target).index($('#account_nav')) == -1 && $(event.target).attr('id') != "account"){

                            if($('#account_nav').css('display') != "none"){
                                $('#account_nav').slideToggle(); 
                            }                
                        }

                        if($(event.target).index($('#projects_nav')) == -1 && $(event.target).attr('id') != "projects_list"){

                            if($('#projects_nav').css('display') != "none"){
                                $('#projects_nav').slideToggle(); 
                            }                
                        }

                        if($(event.target).index($('#context_nav')) == -1 && $(event.target).attr('id') != "context"){

                            if($('#context_nav').css('display') != "none"){
                                $('#context_nav').slideToggle(); 
                            }                
                        }

                        if($(event.target).index($('#search_nav')) == -1 && $(event.target).attr('id') != "search_icon"){

                            if($('#search_nav').css('display') != "none"){
                                $('#search_nav').slideToggle(); 
                            }                
                        }
                    });
                */

            });



        </script>

        {% block extra_head %}{% endblock %}
    </head>
    <body>
        <div id="top_nav" class="both">
            <form action="/issue/search" method="POST">{% csrf_token %}
            <div class="left"><a href="/" class="ui-icon ui-icon-home" id="home_icon"></a></div>
            <div class="right"> 
                <div class="main_nav_button" id="context">Context Drop Down </div> | 
                <div class="main_nav_button" id="projects_list">Project List </div>|
                <div class="main_nav_button"><a id="account">{{user|truncatechars:15}} </a></div>|
                <div class="ui-icon ui-icon-search" id="search_icon"></div>
                <div class="main_nav_button"><input type="text" name="searchText" id="search"/><input type="submit" value="search"/></div>
            </div>
            </form>
            <div id="context_nav" class="container_nav"> 
                {% block context_nav %}{% endblock %}  
            </div>
            <div id="projects_nav" class="container_nav"> 
                {% for project in projects%}
                   <a href="/project/{{project.id}}">{{project.name}}</a>
                {% endfor %}
                <a href="/project/new">New Project</a>
            </div>
            <div id="account_nav" class="container_nav">   
                <a href="/accounts/account_settings">Account Settings</a>
                <a href="/accounts/logout/?next=/">Logout</a>
            </div>
            <div id="search_nav" class="container_nav">   
                <a href="/issue/advsearch">Advanced Search</a>
            </div>
            
            
        </div>
        <p class="both"></p>
        <h1>
        {% if page_type %}
            {{page_type}} 
        {% endif %}
        {% if page_value %}
        <span>::{{page_value}}</span>
        {% endif %}
        </h1>
        <div class="both">&nbsp;</div>
            {% block container %}{% endblock %}
    </body>
</html>
