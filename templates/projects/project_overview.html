{% extends "projects/base.html" %}
{% load staticfiles %}
{% comment %}
Extends /templates/projects/base.html

==Blocks Available==
	additionalHead (from /templates/base.html)
		Used to add additional <link/>, <style/>, and/or <script/> tags to the <head/>
		SHOULD BE USED SPARINGLY - if CSS or JS needs to be added, refer to Gadget.css and Gadget.js, respectively
	contextNav (from /templates/base.html)
		Used to add/modify the context menu items
	baseContent (from /templates/base.html)
		Content that appears in the <body/> of the document. Is wrapped within <div#globalwrap/> and appears after <div#sitenav/>
		**NOTE: using baseContent will OVERRIDE bodyContent unless a bodyContent block is contained within**
	modalsIncluded (from /templates/base.html)
		Used specifically to contain the HTML for modals used by Bootstrap
		This content is hidden by default, is wrapped within a <div/> after <div#globalwrap/> and appears before any end scripts
	endScripts (from /templates/base.html)
		Used to include additional <script/> for the page
		Appears outside of <div#globalwrap/>, after any global <script/> and before the closing <body/> tag
	pageTitle (from /templates/projects/base.html)
		Supplies text to be displayed at the top of the page below the global nav bar
		Appears in <h1#pagetitle/> within <header#pageheader>
	bodyContent (from /templates/projects/base.html)
		Used to display any and all of the pages content
		Appears within <div#maincontent>
		**NOTE: made available by baseContent - if baseContent is defined within the template, bodyContent will not be displayed unless contained within baseContent**
{% endcomment %}

{% block pageTitle %}
Project
{% endblock %}

{% block additionalHead%}
	<style type="text/css">
    .meta-issue-object {
        float: left;
        height: 100px;
        width: 100px;
        border: 1px solid black;
        margin: 10px;
        position:absolute;
    }
</style>

{% endblock%}

{% block contextNav %}
	<li class="nav-header">New</li>
	<li><a href="{% url 'issues.views.issue_form_project' project.id %}">Issue</a></li>
	<li><a href="{% url 'issues.views.meta_issue_form' %}">Meta Issue</a></li>
	<li><a href="{% url 'issues.views.issue_form_project' project.id %}">Risk</a></li>
	<li><a href="{% url 'checklists.views.checklist_form_project' project.id %}">Checklist</a></li>
	<li class="nav-header">Lists</li>
	<li><a href="{% url 'projects.views.project_stats' project.id %}">Report</a></li>
	<li><a href="{% url 'checklists.views.project_checklists' project.id %}">Checklists</a></li>
	<li class="divider"></li>
	<li><a href="{% url 'projects.views.edit' project.id %}">Edit Project</a></li>
{% endblock%}

{% block bodyContent %}
	<article class="row">
		<div id="project-column-main" class="span9 metainfo-maincolumn">
			<div id="project-details" class="well">
				<section class="media">
					<div class="media-body">
						<header>
							<h3 class="media-header">Scope</h3>
						</header>
						{{project.scope}}
					</div>
				</section>
				<section class="media">
					<div class="media-body">
						<header>
							<h3 class="media-header">Description</h3>
						</header>
						{{project.description}}
					</div>
				</section>
				<section class="media">
					<div class="media-body">
						<header>
							<h3 class="media-header">Business Case</h3>
						</header>
						{{project.business_case}}
					</div>
				</section>
			</div>

			<div id="project-issues" class="well">
				<header>
						<h3 class="media-header"><a id="issue-view-toggle">Visual View</a></h3>
				</header>
				<div id="project-issues-text">
					<section class="media">
						
						<div class="media-body">
							<header>
								<h3 class="media-header">Meta Issues</h3>
							</header>
							<table class="table">
								<thead>
							        <tr>
							            <th>Title</th>
							            <th>Type</th>
							            <th>Stats</th>
							        </tr>
							    </thead>
							    <tbody>
							        {% for meta in metas %}<tr>
							            <td><a href="{% url 'issues.views.meta_issue_overview'  meta.id  %}">{{ meta.title }}</a></td>
							            <td>{{ meta.mi_type }}</td>
							            <td><a href="{% url 'issues.views.meta_issue_stats' meta.id %}">Stats</a></td>
							        </tr>{% empty %}<tr><td><em>No meta-issues for this project.</em></td></tr>
							        {% endfor %}
							    </tbody>
						    </table>
						</div>
					</section>

					<section class="media">
						<div class="media-body">
							<header>
								<h3 class="media-header">Issues</h3>
							</header>
							<table class="table">
								<caption>
									Incomplete
								</caption>
								<thead>
									<tr>
										<th>Summary</th>
										<th>Status</th>
										<th>Assigned To</th>
									</tr>
								</thead>
								<tbody>
								{% for issue in incomplete_issues%}
									<tr>
										<td><a href="{% url 'issues.views.issue_overview' issue.id %}" title="{{issue.description}}">{{issue.summary}}</a></td>
										<td>{{issue.status}}</td>
										<td>{{issue.assigned_to}}</td>
									</tr>
								{% endfor %}
								</tbody>
							</table>
							<table class="table">
								<caption>
									Completed
								</caption>
								<thead>
									<tr>
										<th>Summary</th>
										<th>Status</th>
										<th>Assigned To</th>
									</tr>
								</thead>
								<tbody>
								{% for issue in fixed_issues%}
									<tr>
										<td><a href="{% url 'issues.views.issue_overview' issue.id %}" title="{{issue.description}}">{{issue.summary}}</a></td>
										<td>{{issue.status}}</td>
										<td>{{issue.assigned_to}}</td>
									</tr>
								{% endfor %}
								</tbody>
							</table>
						</div>
					</section>
				</div>
				<div id="project-issues-visual" style="display:none;">
					{% for meta in metas %}
						<div id="meta-issue-{{meta.id}}" class="meta-issue-object"><strong>{{meta.title}}</strong></br></br></div>
					{% endfor %}

				</div>
			</div>
		</div>

		<div id="project-column-aside" class="span3 metainfo-asidecolumn">
			<aside id="project-metainfo" class="well metainfo metainfo-show">
				<div class="pull-right">
					<button id="metainfo-toggle" class="btn btn-mini" type="button"><i class="icon-resize-small"></i></button>
				</div>
				<div id="project-metainfo-content" class="metainfo-content">
					<dl>
						<dt>Status:</dt>
							<dd>{{project.status}}</dd>
						<dt>Product Owner:</dt>
						{% if project.product_owner.id %}
							<dd><a href="{% url 'auth.views.user_overview' project.product_owner.id %}">{{project.product_owner}}</a></dd>
						{% else %}
							<dd>{{project.product_owner}}</dd>
						{% endif %}
						<dt>Project Manager:</dt>
						{% if project.project_manager.id %}
							<dd><a href="{% url 'auth.views.user_overview' project.project_manager.id %}">{{project.project_manager}}</a></dd>
						{% else %}
							<dd>{{project.project_manager}}</dd>
						{% endif %}	
						<dt>Lead Developer:</dt>
						{% if project.lead_developer.id %}
							<dd><a href="{% url 'auth.views.user_overview' project.lead_developer.id %}">{{project.lead_developer}}</a></dd>
						{% else %}
							<dd>{{project.lead_developer}}</dd>
						{% endif %}
						<dt>Priority:</dt>
							<dd>{{project.priority}}</dd>
						<dt>Slug:</dt>
							<dd>{{project.slug}}</dd>
						<dt>Logo:</dt>
							<dd>{{project.logo}}</dd>
						<dt>Potential End Date:</dt>
							<dd>{{project.potential_end_date}}</dd>
						<dt>Current Phase:</dt>
							<dd>{{project.current_phase}}</dd>
						<dt>Phase Planning Start:</dt>
							<dd>{{project.phase_planning_start}}</dd>
						<dt>Phase Planning End:</dt>
							<dd>{{project.phase_planning_end}}</dd>
					</dl>
				</div>
			</aside>
		</div>
	</article>
{% endblock %}




{% block endScripts %}
<script src="{% static 'js/jquery.jsPlumb-1.4.1-all-min.js' %}"></script>
<script src="{% static 'js/jquery.ui.touch-punch.min.js' %}"></script>

<script type="text/javascript">
	var endpointOptions;

	$(document).ready(function(){
		jsPlumb.importDefaults({
			DragOptions : { cursor: 'pointer', zIndex:2000 },
			EndpointStyles : [{ fillStyle:'#225588' }, { fillStyle:'#558822' }],
			Endpoints : [ [ "Dot", {radius:7} ], [ "Dot", { radius:11 } ]],
		});
		
		endpointOptions = {
			anchor:[ "LeftMiddle", "RightMiddle" ], 
				isSource:true, 
				isTarget:true,
				connector : "Straight",
				connectorStyle: { lineWidth:7, strokeStyle:'#005580' },

		};

		jsPlumb.draggable($('.meta-issue-object'));
	})
	
	//$('.meta-issue-object').each(function(){
		//jsPlumb.draggable($(this).attr('id'));
		
	//});

	$('#issue-view-toggle').click(function(){
		$('#project-issues-text').fadeToggle(function(){
			$('#project-issues-visual').height($('#project-issues-text').height());
			$('#project-issues-visual').width($('#project-issues-text').width());
			$('#project-issues-visual').fadeToggle(function(){				
				drawProjectOverview();
			});	
		});
		
	});

	function drawProjectOverview(){
		var meta1Endpoint = jsPlumb.addEndpoint('meta-issue-1', { anchor:"RightMiddle" }, endpointOptions );
		var meta2Endpoint = jsPlumb.addEndpoint('meta-issue-2', { anchor:"LeftMiddle" }, endpointOptions );
		var meta3Endpoint = jsPlumb.addEndpoint('meta-issue-3', { anchor:"LeftMiddle" }, endpointOptions );

		jsPlumb.connect({ 
			source:meta1Endpoint,
			target:meta2Endpoint

		});

		jsPlumb.connect({ 
			source:meta2Endpoint,
			target:meta3Endpoint

		});

	}
</script>
{% endblock %}