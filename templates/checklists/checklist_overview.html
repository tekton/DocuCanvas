{% extends "base.html" %}
{% load set_var%}

{% block context_nav %}
    <a href="/project/{{checklist.project.id}}">{{checklist.project.name}}</a>
    <a href="/checklist/new/{{checklist.project.id}}">New Checklist</a>
{% endblock%}

{% block container %}
    <form id = 'checklistForm' action="/checklist/{{checklist.id}}/edit" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{formset.management_form}}
        <div>
            Name: {{checklist_form.name}} <br />
            project: {{checklist_form.project}}<br />
            {{formset|length}}
            <div id ='checklistContainer'>
              <!--
                {% for item in layout_items %}
                  {{item.title}} | {{item.order}}<br />
                {% endfor %}
              -->
                <!--{% for form in formset %}
                  {{form.as_table}}
                {% endfor %}-->
            </div>
        </div>
        <input title='Add a new checklist item' type='button' name='add_checklist_item' value='Add Item' onclick = 'addCheckListItem()'/>
    <input type="submit" name="submit" value="Submit"/>
    </form><br>


    <script>
    var checklistNumber = "{{num_checklist_items}}";
    var orderNumber = parseInt(checklistNumber) + 1;
    function addCheckListItem(){
        $('#checklistContainer').append("<div>\
          <label for='id_checklistlayoutitems_set-"+checklistNumber+"-title'>Title: </label>\
            <input id='id_checklistlayoutitems_set-"+checklistNumber+"-title' maxlength='255' name='checklistlayoutitems_set-"+checklistNumber+"-title' type='text' />\
            <input id='sort' name='checklistlayoutitems_set-"+checklistNumber+"-order' type='hidden' value ='"+orderNumber+"' />\
        </div>\
          <input id='id_checklistlayoutitems_set-"+checklistNumber+"-Checklist' name='checklistlayoutitems_set-"+checklistNumber+"-Checklist' type='hidden' />\
          <input id='id_checklistlayoutitems_set-"+checklistNumber+"-id' name='checklistlayoutitems_set-"+checklistNumber+"-id' type='hidden' />");
        checklistNumber++;
        $('#id_checklistlayoutitems_set-TOTAL_FORMS').val(function(i, oldval){
            return oldval++;
        });
        console.log($('#id_checklistlayoutitems_set-TOTAL_FORMS').val());
        //$('#checkListTable').append('<input type="submit" name="submit" value="Submit">');
    };
    $(function() {
        $("#checklistContainer").sortable({
          stop: function(e, ui){
             $('#checklistContainer input[id$="order"]').each(function(i){
              this.value = i
            })
          }
        });
        $("#checklistContainer").disableSelection();
      });
    $(document).ready(function(){
        {% for i in formset %}
        var positionCounter = {{forloop.counter0}};
        console.log(positionCounter);
            {% for form in formset %}
             if ({{form.order.value}} == positionCounter){
                             $('#checklistForm #checklistContainer').append('<div>\
                                 Title: {{ form.title }}\
                                 {{form.order}}\
                                 {{ form.id }}\
                                 </div>');
                         }
            {% endfor %}
        {% endfor %}
    });
</script>

{% endblock %}
