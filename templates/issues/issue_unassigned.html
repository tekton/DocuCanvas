{% extends "base.html" %}
{% load set_var %}

{% block extra_head %}
<link rel="stylesheet" type="text/css" href="/static/css/dashboard.css"/>
<script type="text/javascript">
    $(document).ready(function() {
        $('a.assign_issue').click(function(){
            var link = $(this);
            $.ajax({
                type:"POST",
                url:"/issue/assign",
                data:{
                    issue:$(this).attr("href").substr( 1 ),
                    assign:"assign"
                },
                success: function(data){
                    // Hides nav menu only after successfull submission
                    NavMenu.HideAll();

                    alert(data['status']);

                    if(data['status'] == "Successfully assigned issue" || data['status'] == "Successfully reassigned issue"){
                        link.closest('td').text("Claimed");
                    }
                },
                error: function(data){
                    alert("Server side error");
                }

            });
        });

    });

</script>
{% endblock %}

{% block context_nav %}
    <a href="issue/new">New Issue</a>
    <a href="reports/edit">Daily Reports</a>
{% endblock %}

{% block container %}

<div class="dashboard_container_section">
    <h3>Unassigned Issues</h3>
    <table class="dashboard_table">
        {% for issue in issues %}
            {% if newest_unassigned != issue.created %}
                {% set newest_unassigned = issue.created %}
                <tr class="date_header"><td colspan="4">{{issue.created}}</td></tr>
            {% endif %}


            <tr>
                <td><a href="/project/{{issue.project.id}}">{{issue.project.name}}</td>
                <td><a href="/issue/{{issue.id}}">{{issue.summary}}</td>
                <td><a href="#{{ issue.id }}" class="assign_issue">Assign to me</a></td>
            </tr>
        {% endfor%}
    </table>
</div>

{% endblock %}
