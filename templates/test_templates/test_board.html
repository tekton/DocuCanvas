<!DOCTYPE HTML>
<html>
    <head>
        <style>
            body{
                margin: 0px;
                padding: 0px;
            }
        </style>
    </head>
    <body>
        <div id = "container"> </div>
         <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v4.4.0.min.js"></script>
          <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
         <script>
         //Set variables for future calculations
            var tooltipInfo = [{"x":400,"y":500,"text": "THIS IS A BUG"}, {"x":200,"y":200,"text": "THIS IS ANOTHER BUG"}, {"x": 150, "y":400, "text": "ANOTHER BUG"}]
            var imageWidth = 1920;
            var imageHeight = 1080;
            var tooltipXPos = 700;
            var tooltipYPos = 300;
            var tooltipWidth = 200;
            var tooltipHeight = 200;
            var tooltipText = "THIS IS A BUG BLAH BLAH BLAH BLAH BLAH asf asdf asdf sadf sadf asdf asdf asdf as dfa sdf asdf asdf asdf asd fa sdfas dfsa df";
            var imageObj = new Image();
            imageObj.onload = function() {
                var bgImage = new Kinetic.Image({
                    image: imageObj,
                    width: imageWidth,
                    height: imageHeight,
                    listening: false,
                    id: 'backgroundImage',
                  });
                bgImage.on('mousedown', function(){
                var mousePos = stage.getMousePosition();
                var x = mousePos.x ;
                var y = mousePos.y ;
                $('body').append('<p>X: ' + x + ' Y: ' + y + '</p>');
                });

                var stage = new Kinetic.Stage({
                    container: 'container',
                    width: imageWidth,
                    height: imageHeight,
                });
                var shapesLayer = new Kinetic.Layer();
                var messageLayer = new Kinetic.Layer();
                shapesLayer.add(bgImage);

                //for (var i=0;i<tooltipInfo.length;i++){
                function bugNote(x, y, bugText, divId){

                    var tooltipId = "#" + divId;
                    var tooltip = new Kinetic.Label({
                        x: x + 15,
                        y: y,
                        opacity: 0.75,
                        listening: false,
                        visible: false,
                        //id: tooltipID,
                        rect:{
                            fill: 'black',
                            pointerDirection: 'left',
                            pointerWidth: 10,
                            pointerHeight: 10,
                            lineJoin: 'round',
                            shadowColor: 'black',
                            shadowBlur: 10,
                            shadowOffset: 10,
                            shadowOpacity: 0.5,
                            }
                    });

                    var circle = new Kinetic.Circle({
                        x: x,
                        y: y,
                        radius: 8,
                        fill: '#00d2ff',
                        stroke: 'black',
                        strokeWidth: 4,
                       // id: circleID,
                    });

                    /*shapesLayer.on('click', function(evt) {
                    // get the shape that was clicked on
                    var shape = evt.targetNode;
                    alert('you clicked on \"' + shape.getId() + '\"');
                    });*/

                    circle.on('mouseover', function(){
                        document.body.style.cursor = 'pointer';
                    });
                    circle.on('mouseout', function(){
                        document.body.style.cursor = 'default';
                    });

                    circle.on('mousedown', function(){
                        if (tooltip.isVisible()){
                            tooltip.hide();
                            shapesLayer.draw();
                            $(tooltipId).css('visibility', 'hidden');

                        }else{
                            tooltip.show();
                            shapesLayer.draw();
                            $(tooltipId).css('visibility', 'visible');
                        };
                    });

                    shapesLayer.add(circle);
                    shapesLayer.add(tooltip);
                    $('body').append("<div id = " + divId + " style = 'width: " + tooltipWidth +"px;  position: absolute; top: " + (y - (tooltipHeight / 10)) + "px; left: " + (x + 25) + "px; background-color: black; opacity: 0.9; visibility: hidden;'><p style = 'color: grey; text-align: center'>" + bugText + "</p></div>");
                //};
                };
                for (var i=0;i<tooltipInfo.length;i++){
                    var newCircle = "circle" + i;
                    newCircle = new bugNote(tooltipInfo[i]["x"], tooltipInfo[i]["y"],tooltipInfo[i]["text"], i);
                };
                //var circle1 = new bugNote(300, 400, 1);
                //var circle2 = new bugNote(500, 100, 2);
                stage.add(shapesLayer);

             };
            imageObj.src = '/static/img/screenshot.png';

         </script>


    </body>
</html>