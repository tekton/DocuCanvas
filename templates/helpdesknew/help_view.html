{% extends "base.html" %}


{% block context_nav %}
    <a href="/help/new">Ask a Question</a>
    <a href="/help/resolved">Resolved Questions</a>
    <a href="/help/pending">Unresolved Questions</a>
    <a href="/help/user">Your Questions</a>
    <a href="/help/edit/{{help.id}}">Edit Question</a>
    {% if user.is_staff %}
    <a href="/help/close_question_91990/{{help.id}}">Admin - Close Question</a>
    {% endif %}
{% endblock %}

{% block style %}
.helpdesk-question{
	word-break: break-all;
}
a.popup{
    position:relative;
    z-index:0;
    text-decoration:none;
}
a.popup:hover{
    z-index:0;
}
a.popup span{
    display:none;
}
a.popup:hover span{
    display:block;
    position:absolute;
    top:15px;
    padding:3px;
    word-break: break-all;
}
.tbl-answer-id{
	font-size:xx-small;
	text-align:right;
}
.tbl-answer-edit{
	font-size:xx-small;
	text-align:left;
}
#helpstatus{
	text-align:right;
}
.helpdesk-edit{
	font-size:x-small;
	text-align:center;
}
.tbl-ack-response{
	font-size:xx-small;
	text-align:center;
}
img.pending-image-help{
    width:60px;
    height:60px;
}
{% endblock %}

{% block container %}
    <input type="hidden" id="help_id" value="{{help.id}}"/>
	<table class="tbl-generic tbl-overview">
		<tr class="tbl-rowheader">
			{% if help.edit_status_bool %}
				<td class="tbl-fauxth"><a href="/help/edit/{{help.id}}">{{help.name}} [*EDITED*]</a></td>
			{% else %}
				<td class="tbl-fauxth"><a href="/help/edit/{{help.id}}">{{help.name}}</a></td>
			{% endif %}
			{% if help.status == '(1, 1)' %}
				<td class="tbl-fauxth" id="helpstatus">Status: No Responses</td>
			{% elif help.status == "('active', 'Active Responses')" %}
				<td class="tbl-fauxth" id="helpstatus">Status: Active</td>
			{% elif help.status == "('resolved', 'Resolved')" %}
				<td class="tbl-fauxth" id="helpstatus">Status: Resolved</td>
			{% elif help.status == "('reopened', 'Re-Opened')" %}
				<td class="tbl-fauxth" id="helpstatus">Status: Re-Opened</td>
			{% elif help.status == "('closed', 'Closed')" %}
				<td class="tbl-fauxth" id="helpstatus">Status: Solved & Sealed</td>
			{% else %}
				<td class="tbl-fauxth" id="helpstatus">Status: {{help.status}}</td>
			{% endif %}
		</tr>
		<tr>
			<td colspan="2">
				<div class="helpdesk-question">{{help.question}}</div>
			</td>
		</tr>
		<tr><td>
		{% for image in images %}
				<a target="_blank" href="/static/{{image.photo}}"><img class="pending-image-help" src="/static/{{image.photo}}"></a>
		{% endfor %}
	</td></tr>
		</table>
		<table class="tbl-generic tbl-overview">
		{% for arrow in answer %}
			<tr class="tbl-rowheader">
				<td class="tbl-fauxth" colspan="3">
					{% if user.id == help.user.id and help.status != "('closed', 'Closed')" %}
						<a class="popup">Answer (Submitted By {{arrow.user}})
							<span>
								<form action="/help/mark_the_input/{{arrow.id}}" id="submit_input_form" method="post" enctype="multipart/form-data">
									{% csrf_token %}
									<input type="submit" value="Remove Answer" id="remove_answer_button"/>
								</form>
							</span>
						</a>
					{% elif user.is_staff %}
						<a class="popup">Answer (Submitted By {{arrow.user}})
							<span>
								<form action="/help/mark_the_input/{{arrow.id}}" id="submit_input_form" method="post" enctype="multipart/form-data">
									{% csrf_token %}
									<input type="submit" value="Remove Answer" id="remove_answer_button"/>
								</form>
							</span>
						</a>
					{% else %}
						Answer (Submitted By {{arrow.user}})
					{% endif %}
					</a>
				</td>
			</tr>
			<tr>
				<td class="tbl-comments-description" colspan="3">
					<div class="helpdesk-question">{{arrow.response}}</div>
				</td>
			</tr>
			<tr>
				<td>
					{% if user == help.user or user.is_staff %}
						<form action="/help/mark_the_input/{{arrow.id}}" id="submit_input_form" method="post" enctype="multipart/form-data">
							{% csrf_token %}
							<input type="submit" value="Remove Answer" id="remove_answer_button"/>
						</form>
					{% endif %}
				</td>
				<td class="tbl-ack-response">
					{% if user.id == help.user.id %}
						{% if help.ack_response %}
							<a href="/help/acknowledge/{{arrow.id}}">-Edit Response-</a>
						{% else %}
							<a href="/help/acknowledge/{{arrow.id}}">-Respond to Answer-</a>
						{% endif %}
					{% endif %}
				</td>
				<td class="tbl-answer-id">
					{{arrow.id}}
				</td>
			</tr>
			{% if help.ack_response %}
			<tr class="tbl-rowheader">
				<td class="tbl-fauxth" colspan="3">
					Response to Answer (from {{help.user}})
				</td>
			</tr>
			<tr>
				<td class="tbl-comments-description" colspan="3">
					<div class="helpdesk-question">{{help.ack_response}}</div>
				</td>
			</tr>
			{% endif %}
		{% endfor %}
	</table>
	<table class="tbl-generic tbl-comments">
		<tr>
			<td colspan="2">
				<form action="/help/response/{{help.id}}" id="submit_response_form" method="post" enctype="multipart/form-data">
					{% csrf_token %}
					<b><a id="comment_title">Submit A Response</a></b></br>
					<div class="comment_textarea">{{help_response.response}}</div>
					<input type='hidden' name="helprequest" id="id_helprequest" value='{{help.id}}'/>
					<input type='hidden' name="user" id="id_user" value='{{user.id}}'/>
					<input type="submit" value="Submit" id="submit_response_button"/>
				</form>
				<br>
			</td>
		</tr>
		{% for comment in comments %}
			<tr class="tbl-rowheader">
				<td class="tbl-fauxth tbl-comments-user">
					{% if user.id == help.user.id and help.status != "('closed', 'Closed')" and help.status != "('resolved', 'Resolved')" %}
						<a class='popup'>
							<b>{{comment.user}}</b>
							<span>
								<form action="/help/mark_the_answer/{{comment.id}}" id="submit_answer_form" method="post" enctype="multipart/form-data">
									{% csrf_token %}
									<input type="submit" value="Mark as Answer" id="submit_answer_button"/>
								</form>
							</span>
						</a>
					{% elif user.is_staff and help.status != "('closed', 'Closed')" and help.status != "('resolved', 'Resolved')" %}
						<a class='popup'><b>{{comment.user}}</b>
							<span>
								<form action="/help/mark_the_answer/{{comment.id}}" id="submit_answer_form" method="post" enctype="multipart/form-data">
									{% csrf_token %}
									<input type="submit" value="Mark as Answer" id="submit_answer_button"/>
								</form>
							</span>
						</a>
					{% elif user.id == comment.user.id %}
						<a href="/help/cmmtedit/{{comment.id}}"><b>{{comment.user}}</b></a>
					{% else %}
						<b>{{comment.user}}</b>
					{% endif %}
				</td>
				<td class="tbl-fauxth tbl-comments-created">
					<a href="mark/{{comment.id}}">{{comment.created}}</a>
				</td>
			</tr>
			<tr>
				{% if user.id == comment.user.id %}
					<td class="tbl-comments-description" colspan="2">
						<a href="help/cmmtedit/{{comment.id}}"><div class="helpdesk-question">{{comment.response}}</div></a>
					</td>
				{% else %}
					<td class="tbl-comments-description" colspan="2">
						<div class="helpdesk-question">{{comment.response}}</div>
					</td>
				{% endif %}
			</tr>
			<tr>
				<td class="tbl-answer-edit">
					<!--<a href="/help/cmmtedit/{{comment.id}}">-EDIT-</a>-->
					{% if user == help.user or user.is_staff %}
						{% if comment.value != "('answer', 'Answer')" %}
							<form action="/help/mark_the_answer/{{comment.id}}" id="submit_answer_form" method="post" enctype="multipart/form-data">
								{% csrf_token %}
								<input type="submit" value="Mark as Answer" id="submit_answer_button"/>
							</form>
						{% else %}
							<form action="/help/mark_the_input/{{comment.id}}" id="submit_input_form" method="post" enctype="multipart/form-data">
								{% csrf_token %}
								<input type="submit" value="Remove Answer" id="remove_answer_button"/>
							</form>
						{% endif %}
					{% endif %}
				</td>
				<td class="tbl-answer-id">
					{{comment.id}}
				</td>
			</tr>
		{% endfor %}
	</table>
{% endblock %}
